{% extends "base.html" %}

{% block title %}Desempenho da Equipe{% endblock %}

{% block content %}
<main class="container my-3" style="max-width: 75%;">
    <!-- Cabeçalho -->
    <section class="text-center mb-5">
        <div class="card text-center" style="background-color: #160840; border: none;">
            <div class="card-body">
                <h1 class="display-10 fw-bold" style="color: #FFFFFF; text-shadow: 2px 1px 1px #87ceeb;">
                    Desempenho de Equipe no Campeonato:<br>{{ campeonato.nome }}
                </h1>
            </div>
        </div>
    </section>

    <!-- Formulário de Seleção -->
    <form method="get" class="my-4">
        <div class="card" style="background-color: #f0faf9; border: 1px solid #191970; padding: 20px; border-radius: 10px;">
            <h4 class="text-center" style="color: #160840; text-shadow: -1px -1px 1 #1E3A8A, 1px -1px 1 #1E3A8A;">
                Selecione a Equipe
            </h4>
            {{ form.as_p }}
            <div class="text-center">
                <button type="submit" class="btn btn-primary" style="background-color: #160840; border-color: #160840;">
                    Visualizar Desempenho
                </button>
            </div>
        </div>
    </form>

    {% if desempenho_dados %}
        <!-- Gráfico de Desempenho -->
        <section class="mt-5">
            <div class="card" style="background-color: #f0faf9; border: 1px solid #191970; padding: 20px; border-radius: 10px;">
                <h4 class="text-center" style="color: #160840; text-shadow: -1px -1px 1 #1E3A8A, 1px -1px 1 #1E3A8A;">
                    Gráfico de Desempenho
                </h4>
                <div class="mt-4">
                    <canvas id="desempenhoGrafico"></canvas>
                </div>
            </div>
        </section>

        <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
        <script>
            const ctx = document.getElementById('desempenhoGrafico').getContext('2d');
            const data = {
                labels: {{ rodadas|safe }},  // Rodadas/Fases no eixo X
                datasets: [
                    {
                        label: 'Pontos Marcados',
                        data: {{ gols_pro|safe }},
                        borderColor: '#1E90FF',
                        fill: false,
                    },
                    {
                        label: 'Pontos Sofridos',
                        data: {{ gols_contra|safe }},
                        borderColor: '#FF6347',
                        fill: false,
                    }
                ]
            };
            const config = {
                type: 'line',
                data: data,
                options: {
                    responsive: true,
                    scales: {
                        x: { title: { display: true, text: 'Rodadas/Fases' } },
                        y: { title: { display: true, text: 'Pontos' } }
                    }
                }
            };
            new Chart(ctx, config);
        </script>

        <!-- Resumo do Desempenho -->
        <section class="mt-4">
            <div class="card" style="background-color: #f0faf9; border: 1px solid #191970; padding: 20px; border-radius: 10px;">
                <h4 class="text-center" style="color: #160840; text-shadow: -1px -1px 1 #1E3A8A, 1px -1px 1 #1E3A8A;">
                    Resumo do Desempenho
                </h4>
                <ul class="mt-3">
                    <li><strong>Saldo de Pontos:</strong> {{ saldo_pontos }}</li>
                    <li><strong>Vitórias:</strong> {{ vitorias }}</li>
                    <li><strong>Empates:</strong> {{ empates }}</li>
                    <li><strong>Derrotas:</strong> {{ derrotas }}</li>
                    <li><strong>Classificado para Eliminatórias:</strong> 
                        {% if classificado_eliminatorias %} Sim {% else %} Não {% endif %}
                    </li>
                </ul>
            </div>
        </section>

        <!-- Histórico de Jogos -->
        <section class="mt-4">
            <div class="card" style="background-color: #f0faf9; border: 1px solid #191970; padding: 20px; border-radius: 10px;">
                <h4 class="text-center" style="color: #160840; text-shadow: -1px -1px 1 #1E3A8A, 1px -1px 1 #1E3A8A;">
                    Histórico de Jogos
                </h4>
                <table class="table table-bordered mt-3">
                    <thead>
                        <tr>
                            <th>Rodada/Fase</th>
                            <th>Adversário</th>
                            <th>Pontos Marcados</th>
                            <th>Pontos Sofridos</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for jogo in historico_jogos %}
                            <tr>
                                <td>{{ jogo.rodada|default:jogo.fase }}</td>
                                <td>{{ jogo.adversario }}</td>
                                <td>{{ jogo.pontos_pro }}</td>
                                <td>{{ jogo.pontos_contra }}</td>
                            </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
        </section>

    {% elif equipe_selecionada %}
        <div class="alert alert-info text-center mt-4" style="background-color: #f8f9fa; color: #160840; border: 1px solid #191970;">
            Nenhum desempenho registrado para esta equipe.
        </div>
    {% endif %}
</main>
{% endblock %}
