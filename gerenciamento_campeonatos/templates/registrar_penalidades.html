{% extends "base.html" %}

{% block title %}Registrar Penalidade{% endblock %}

{% block content %}
<div class="container mt-5">
    <div class="card shadow-lg p-4" style="border-radius: 10px; background-color: #f8f9fa; border: 1px solid #191970;">
        <h1 class="text-center mb-4" style="color: #160840;">Registrar Penalidade</h1>
        <p class="text-center mb-4" style="color: #555;">Campeonato: <strong>{{ campeonato.nome }}</strong></p>

        <form method="post" action="{% url 'registrar_penalidade' campeonato.id %}">
            {% csrf_token %}

            <!-- Seleção de Jogo -->
            <div class="mb-4">
                <label for="jogo_selecionado" class="form-label fw-bold" style="color: #160840;">Selecione um Jogo:</label>
                <select id="jogo_selecionado" name="jogo_id" class="form-select border-primary" required onchange="atualizarEquipes()">
                    <option value="" disabled selected>Escolha um jogo...</option>
                    {% for jogo in jogos %}
                        <option value="{{ jogo.id }}"
                                data-time-casa="{{ jogo.time_casa.equipe }}"
                                data-time-fora="{{ jogo.time_fora.equipe }}">
                            Rodada {{ jogo.rodada.numero }}: {{ jogo.time_casa.equipe }} vs {{ jogo.time_fora.equipe }} 
                            ({{ jogo.data_horario|date:"d/m/Y H:i" }})
                        </option>
                    {% endfor %}
                </select>
            </div>

            <!-- Tipo de Penalidade -->
            <div class="mb-4">
                <label for="tipo_penalidade" class="form-label fw-bold" style="color: #160840;">Tipo de Penalidade:</label>
                <select id="tipo_penalidade" name="tipo_penalidade" class="form-select border-primary" required>
                    <option value="" disabled selected>Selecione o tipo de penalidade...</option>
                    <option value="participante">Por Participante</option>
                    <option value="equipe">Por Equipe</option>
                </select>
            </div>

            <!-- Seleção de Equipe -->
            <div class="mb-4" id="equipe_selecao" style="display: none;">
                <label for="equipe" class="form-label fw-bold" style="color: #160840;">Selecione a Equipe:</label>
                <select id="equipe" name="equipe" class="form-select border-primary">
                    <option value="" disabled selected>Escolha uma equipe...</option>
                </select>
            </div>

            <!-- Seleção de Participante -->
            <div class="mb-4" id="participante_selecao" style="display: none;">
                <label for="participante_id" class="form-label fw-bold" style="color: #160840;">Selecione o Participante:</label>
                <select id="participante_id" name="participante_id" class="form-select border-primary">
                    <option value="" disabled selected>Escolha um participante...</option>
                    {% for participante in participantes %}
                        <option value="{{ participante.id }}">{{ participante.nome }}</option>
                    {% endfor %}
                </select>
            </div>

            <!-- Tipo Específico de Penalidade -->
            <div class="mb-4" id="tipo_cartao_selecao" style="display: none;">
                <label for="tipo_cartao" class="form-label fw-bold" style="color: #160840;">Tipo de Penalidade Específica:</label>
                <select id="tipo_cartao" name="tipo_cartao" class="form-select border-primary">
                    <option value="" disabled selected>Escolha o tipo específico...</option>
                </select>
            </div>

            <!-- Motivo da Penalidade -->
            <div class="mb-4">
                <label for="motivo" class="form-label fw-bold" style="color: #160840;">Motivo da Penalidade:</label>
                <textarea id="motivo" name="motivo" class="form-control border-primary" rows="3" placeholder="Descreva o motivo da penalidade"></textarea>
            </div>

            <!-- Botões de Ação -->
            <div class="text-center">
                <button type="submit" class="btn btn-success w-50" style="background-color: #28a745; border-color: #28a745;">Registrar Penalidade</button>
                <a href="{% url 'visualizar_tabela' campeonato.id %}" class="btn btn-secondary w-25">Voltar</a>
            </div>
        </form>
    </div>
</div>

<script>
    // Função para exibir seleção de equipe ou participante baseado no tipo de penalidade
    document.getElementById('tipo_penalidade').addEventListener('change', function() {
        const participanteSelecao = document.getElementById('participante_selecao');
        const equipeSelecao = document.getElementById('equipe_selecao');
        const tipoCartaoSelecao = document.getElementById('tipo_cartao_selecao');
        const tipoCartaoSelect = document.getElementById('tipo_cartao');

        if (this.value === 'participante') {
            participanteSelecao.style.display = 'block';
            equipeSelecao.style.display = 'none';
            tipoCartaoSelecao.style.display = 'block';
            tipoCartaoSelect.innerHTML = '<option value="amarelo">Cartão Amarelo</option><option value="vermelho">Cartão Vermelho</option>';
        } else if (this.value === 'equipe') {
            participanteSelecao.style.display = 'none';
            equipeSelecao.style.display = 'block';
            tipoCartaoSelecao.style.display = 'block';
            tipoCartaoSelect.innerHTML = '<option value="expulsao">Expulsão</option><option value="outro">Outro</option>';
        } else {
            participanteSelecao.style.display = 'none';
            equipeSelecao.style.display = 'none';
            tipoCartaoSelecao.style.display = 'none';
        }
    });

    // Função para atualizar as equipes com base no jogo selecionado
    function atualizarEquipes() {
        const jogoSelecionado = document.getElementById('jogo_selecionado');
        const equipeSelecao = document.getElementById('equipe');
        equipeSelecao.innerHTML = ''; // Limpa as opções anteriores

        if (jogoSelecionado.value) {
            const timeCasa = jogoSelecionado.options[jogoSelecionado.selectedIndex].getAttribute('data-time-casa');
            const timeFora = jogoSelecionado.options[jogoSelecionado.selectedIndex].getAttribute('data-time-fora');

            // Adiciona as equipes do jogo selecionado
            equipeSelecao.options.add(new Option(timeCasa, 'casa'));
            equipeSelecao.options.add(new Option(timeFora, 'fora'));
        }
    }
</script>

{% endblock %}
