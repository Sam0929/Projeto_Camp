{% extends "base.html" %}

{% block title %}Chave de Confrontos{% endblock %}

{% block content %}
<div class="container mt-5">
    <div class="text-center">
        <h1 class="display-4">Chave de Confrontos</h1>
        <p class="lead">Confira os jogos das fases eliminat√≥rias do campeonato!</p>
        <hr class="my-4">
        <p>Campeonato: {{ campeonato.nome }}</p>
        <p>Data de in√≠cio: {{ campeonato.data_inicio|date:"d/m/Y" }}</p>
        <p>Data de fim: {{ campeonato.data_fim|date:"d/m/Y" }}</p>
    </div>

    {% if vencedor_final %}
    <div class="mt-5 p-4 bg-success text-white text-center rounded">
        <h2 class="display-6">Equipe Vencedora</h2>
        <p class="h4">{{ vencedor_final }}</p>
        <p class="h5">Pr√™mio: R$ {{ premiacao }}</p>
        <span class="badge bg-light text-success p-2 mt-2">üèÜ Parab√©ns aos campe√µes! üèÜ</span>
    </div>
    {% endif %}

    <div class="mt-4">
        {% for fase, jogos in jogos_por_rodada.items %}
            <h3 class="mt-4 text-center text-primary">{{ fase|title }}</h3>
            <ul class="list-group mb-3">
                {% for jogo in jogos %}
                    <li class="list-group-item">
                        <div class="d-flex justify-content-between align-items-center">
                            <div>
                                {% if jogo.time_casa %}
                                    <strong>{{ jogo.time_casa.equipe }}</strong>
                                {% else %}
                                    <span class="text-primary">√Ä definir</span>
                                {% endif %}
                                vs
                                {% if jogo.time_fora %}
                                    <strong>{{ jogo.time_fora.equipe }}</strong>
                                {% else %}
                                    <span class="text-primary">√Ä definir</span>
                                {% endif %}
                                <small class="text-muted">
                                    {{ jogo.rodada.data|date:"d/m/Y" }} {{ jogo.rodada.data|time:"H:i" }}
                                </small>
                            </div>
                            <div>
                                {% if jogo.resultado_eliminatorio %}
                                    <span class="badge bg-success rounded-pill">
                                        Resultado: {{ jogo.resultado_eliminatorio.gols_time_casa }} - {{ jogo.resultado_eliminatorio.gols_time_fora }}
                                    </span>
                                {% else %}
                                    <span class="badge bg-secondary rounded-pill">Resultado: Pendente</span>
                                {% endif %}
                            </div>
                        </div>

                        <!-- Exibi√ß√£o de Penalidades do Jogo com fonte reduzida -->
                        {% if jogo.penalidades_eliminatorias.exists %}
                            <div class="mt-2 ms-3" style="font-size: 0.85em;">
                                <h6>Penalidades:</h6>
                                <ul class="list-group list-group-flush">
                                    {% for penalidade in jogo.penalidades_eliminatorias.all %}
                                        <li class="list-group-item">
                                            <strong>{{ penalidade.tipo_penalidade|title }}:</strong>
                                            {% if penalidade.participante %}
                                                {{ penalidade.participante.nome }}
                                            {% else %}
                                                Equipe
                                            {% endif %}
                                            - {{ penalidade.motivo }}
                                            <small class="text-muted">{{ penalidade.data|date:"d/m/Y H:i" }}</small>
                                        </li>
                                    {% endfor %}
                                </ul>
                            </div>
                        {% else %}
                            <div class="text-muted mt-2 ms-3" style="font-size: 0.85em;">Nenhuma penalidade registrada.</div>
                        {% endif %}
                    </li>
                {% endfor %}
            </ul>
        {% endfor %}
    </div>

    <div class="mt-4 text-center">
        <a href="{% url 'registrar_resultados_eliminatorias' campeonato_id=campeonato.id %}" class="btn btn-warning w-100 mt-2">Registrar Resultados Eliminat√≥rias</a>
        <a href="{% url 'registrar_penalidades_eliminatorias' campeonato_id=campeonato.id %}" class="btn btn-danger w-100 mt-2">Registrar Penalidades Eliminat√≥rias</a>
    </div>
</div>
{% endblock %}
