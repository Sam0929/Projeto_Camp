{% extends "base.html" %}

{% block title %}Chave de Confrontos{% endblock %}

{% block content %}
<main class="container my-7" style="max-width: 75%;">
    <section class="chave-confrontos-section">
        <!-- Cabe√ßalho -->
        <div class="row mb-4">
            <div class="col-12">
                <div class="card text-center" style="background-color: #160840; border: none;">
                    <div class="card-body">
                        <h1 class="display-4 fw-bold" style="color: #FFFFFF; text-shadow: 2px 1px 1px #87ceeb;">
                            Chave de Confrontos
                        </h1>
                        <p class="lead text-light">
                            Confira os jogos das fases eliminat√≥rias do campeonato!
                        </p>
                        <p class="text-light mb-0"><strong>Campeonato:</strong> {{ campeonato.nome }}</p>
                        <p class="text-light">
                            <strong>Data de in√≠cio:</strong> {{ campeonato.data_inicio|date:"d/m/Y" }} |
                            <strong>Data de fim:</strong> {{ campeonato.data_fim|date:"d/m/Y" }}
                        </p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Vencedor Final -->
        {% if vencedor_final %}
        <div class="card mb-4" style="background-color: #f0faf9; border: 1px solid #191970; border-radius: 10px;">
            <div class="card-body text-center">
                <h2 class="display-6 text-success">Equipe Vencedora</h2>
                <p class="h4 text-dark">{{ vencedor_final }}</p>
                <p class="h5 text-primary">Pr√™mio: R$ {{ premiacao }}</p>
                <span class="badge bg-light text-success p-2 mt-2">üèÜ Parab√©ns aos campe√µes! üèÜ</span>
            </div>
        </div>
        {% endif %}

        <!-- Fases e Jogos -->
        <div class="row">
            {% for fase, jogos in jogos_por_rodada.items %}
            <div class="col-12 mb-4">
                <div class="card" style="border: 1px solid #191970; border-radius: 10px;">
                    <div class="card-header text-center" style="background-color: #160840; color: #FFFFFF;">
                        <h3 class="fw-bold">{{ fase|title }}</h3>
                    </div>
                    <div class="card-body">
                        {% if jogos %}
                        <ul class="list-group">
                            {% for jogo in jogos %}
                            <li class="list-group-item" style="border: none;">
                                <div class="d-flex justify-content-between align-items-center">
                                    <div>
                                        {% if jogo.time_casa %}
                                            <strong style="color: #160840;">{{ jogo.time_casa.equipe }}</strong>
                                        {% else %}
                                            <span class="text-primary">√Ä definir</span>
                                        {% endif %}
                                        <span style="color: #555;">vs</span>
                                        {% if jogo.time_fora %}
                                            <strong style="color: #160840;">{{ jogo.time_fora.equipe }}</strong>
                                        {% else %}
                                            <span class="text-primary">√Ä definir</span>
                                        {% endif %}
                                        <small class="text-muted">
                                            {{ jogo.rodada.data|date:"d/m/Y" }} {{ jogo.rodada.data|time:"H:i" }}
                                        </small>
                                    </div>
                                    <div>
                                        {% if jogo.resultado_eliminatorio %}
                                            <span class="badge bg-success rounded-pill">
                                                Resultado: {{ jogo.resultado_eliminatorio.gols_time_casa }} - {{ jogo.resultado_eliminatorio.gols_time_fora }}
                                            </span>
                                        {% else %}
                                            <span class="badge bg-secondary rounded-pill">Resultado: Pendente</span>
                                        {% endif %}
                                    </div>
                                </div>

                                <!-- Penalidades -->
                                {% if jogo.penalidades_eliminatorias.exists %}
                                <div class="mt-2 ms-3" style="font-size: 0.85em; color: #555;">
                                    <h6>Penalidades:</h6>
                                    <ul class="list-group list-group-flush">
                                        {% for penalidade in jogo.penalidades_eliminatorias.all %}
                                        <li class="list-group-item" style="font-size: 0.9em; background-color: #f8f9fa;">
                                            <strong>{{ penalidade.tipo_penalidade|title }}:</strong>
                                            {% if penalidade.participante %}
                                                {{ penalidade.participante.nome }}
                                            {% else %}
                                                Equipe
                                            {% endif %}
                                            - {{ penalidade.motivo }}
                                            <small class="text-muted">{{ penalidade.data|date:"d/m/Y H:i" }}</small>
                                        </li>
                                        {% endfor %}
                                    </ul>
                                </div>
                                {% endif %}
                            </li>
                            {% endfor %}
                        </ul>
                        {% else %}
                        <p class="text-center text-muted">Nenhum jogo registrado para esta fase.</p>
                        {% endif %}
                    </div>
                </div>
            </div>
            {% endfor %}
        </div>

        <!-- A√ß√µes Administrativas -->
        {% if user.is_authenticated and user.is_superuser %}
        <div class="text-center mt-4">
            <a href="{% url 'registrar_resultados_eliminatorias' campeonato_id=campeonato.id %}" class="btn btn-warning w-100 mb-2">
                Registrar Resultados Eliminat√≥rias
            </a>
            <a href="{% url 'registrar_penalidades_eliminatorias' campeonato_id=campeonato.id %}" class="btn btn-danger w-100">
                Registrar Penalidades Eliminat√≥rias
            </a>
        </div>
        {% endif %}
    </section>
</main>
{% endblock %}
